function isEmail(email) {
  var regex = /^([a-zA-Z0-9_.+-])+\@(([a-zA-Z0-9-])+\.)+([a-zA-Z0-9]{2,4})+$/;
  return regex.test(email);
}

function str_not_null(str)
{
	if(str)
	{
		return str;
	}
	else
	{
		return '';
	}
}

function cut_intro(str) 
{
	if(str.length > 150)
	{
		var res = str.slice(0, 147);
		return res + '...';
	}
	else
	{
		return str;
	}
}

function update_banners_categorias(marca)
{
	$('.banner-categoria-container').each(function(){
		var elem = this;
		var id_categoria = $(elem).attr('data-id');
				
		$.ajax({
            url: '/ajax.php?f=banners_categorias',			
            type: 'POST',
            data: {marca: marca, id: id_categoria},
            dataType: 'text',
            success: function(data){
				$(elem).html(data);
			}
        });
		
	});		
}

if(window.lang == 'es')
{
	var text_ver_mais = 'Ver más';
	var text_ver_menos = 'Ver menos';
}
else
{
	var text_ver_mais = 'Ver mais';
	var text_ver_menos = 'Ver menos';
}

var update_my_algolia = function(data, add_to = false){
	
	
		console.log('LANG: ' + window.lang); 
	var position = 1;
	var html = '';
	var html2 = '<div class="row">';
	var list_type = 'grid';
	
	if($("#list_type_value").length != 0) {
		list_type = $("#list_type_value").val();
	}
	
	var dia_entrega_em_sock = $('#dia_entrega_em_sock').val();
	
	$.each(data.hits, function(index, produto){
		if (typeof produto.categorias[0] !== 'undefined') {
		ga('ec:addImpression', {           
		  'id': produto.id,
		  'name': produto['name_' + window.lang],
		  'category': produto.categorias[0]['name_' + window.lang],
		  'brand': produto.marca.name,
		  'list': 'Lista',
		  'price': produto.value,
		  'position': position
		});
		}
		else
		{
			ga('ec:addImpression', {           
		  'id': produto.id,
		  'name': produto['name_' + window.lang],
		  'category': '',
		  'brand': produto.marca.name,
		  'list': 'Lista',
		  'price': produto.value,
		  'position': position
		});
		}
  
		
		
	if(!produto.image)
	{
		var image = 'https://template.egitana.' + window.lang + '/no-img/produtos/listagem/img.png';
	}
	else
	{
		var image = 'https://detalhes.egitana.' + window.lang + '/'+produto.image
	}
	
	html += '<a href="'+produto['url_' + window.lang]+'"><div class="owl-item w325" ><div class="produto" style="min-height: 310px;"><div class="p-inner" style="border: none;"><div class="p-grid"><span class="item_tags">'+produto.labels+'</span><span class="p-image"><img src="'+image+'" style="max-width: 100%;" class="imagem" alt="'+produto['name_' + window.lang]+'" title="'+produto['name_' + window.lang]+'"><div class="p-mask"></div></span>'; 
	
	if(produto.value > 0)
	{
		if(produto['sob_consulta_' + window.lang] == '')
		{
			html += '<div style="float:right;"><img src="https://template.egitana.' + window.lang + '/img/cart_btn.jpg" alt="adicionar ao carrinho" /></div>';
		}
	}
	
	html += '<div class="p-info">';
	
	if(produto.value > 0)
	{
		html += '<span class="price"><span class="preco">'+produto['price_' + window.lang]+produto['sob_consulta_' + window.lang]+'</span></span>';
	}
	else
	{
		html += '<span class="price"><span class="preco">&nbsp;</span></span>';
	}
	
	if(window.lang == 'es')
	{ 
		informacoes_str = 'informacion';
	}
	else
	{
		informacoes_str = 'informações';
	}
	
	html += '<h3 class="p-title" style="min-height: 45px;margin-bottom: 5px;"><a href="'+produto['url_' + window.lang]+'"><h3 class="hlimpo">'+produto['name_' + window.lang]+'</h3></a></h3><span class="cat" style="color: #7F7F7F">'+str_not_null(produto.tipo.name)+'</span><br /><span class="stocks entrega_rapida">'+produto['dispo_' + window.lang]+'</span><br /><div style="min-height: 90px;">'+cut_intro(produto['intro_' + window.lang])+'</div> [+] '+informacoes_str+'<div style="clear:both"></div>	</div></div></div></div></div></a>';
	
	
	
	
		
	/* HTML2 ========================== */ 
	
	console.log(list_type);
	
	if(list_type == 'grid')
	{
		html2 += '<a href="'+produto['url_' + window.lang]+'?pes=1"><div class="col-sm-4 caixaproduto3"><div class="paddinginterior"> <img src="'+image+'" alt="'+produto['name_' + window.lang]+'" style="max-width: 300px; width: 100%" title="'+produto['name_' + window.lang]+'"><div class="nomeprodutocaixa"><h3 class="hlimpo">'+produto['name_' + window.lang]+'</h3></div>';
		
		if(produto.stock > 0)
		{
			if(window.lang == 'es')
			{
				html2 += '<span class="entrega" style="margin-right: 25px; float: right;">En stock &nbsp;</span>';
			}
			else
			{
				html2 += '<span class="entrega" style="margin-right: 25px; float: right;">Em stock &nbsp;</span>';
			}
			
		}
		
		html2 += '<div class="preco3"><span >'+produto['price_' + window.lang]+produto['sob_consulta_' + window.lang]+'</span></div>';
		html2 += '<div class="clear3"></div>';	
		
		
		html2 += '';
		html2 += '</div></div></a> ';
		/* ---------------------------- */
		
		if(!(position%3))
		{
			html2 += '</div><div class="sephorizontal2"></div><div class="row">';
		}
		
	}
	else
	{
				
				
				html2 += '<div class="produtolista hover-pointer" onclick="window.location = \''+produto['url_' + window.lang]+'\'"><div class="lateral2"> <div style="float:left; max-width: 80%"><h2 class="nomeproduto"><a href="'+produto['url_' + window.lang]+'">'+produto['name_' + window.lang]+'</a></h2> <div class="clear10"></div>'+str_not_null(produto.tipo.name)+'</div> <div class="right2"> <span class="precolistagens">'+produto['price_' + window.lang]+produto['sob_consulta_' + window.lang]+'</span>';
				
				
				/* if(produto.price_before !== '')
				{		
					if(Math.round(produto.desconto) >= 5)
					{
						/* html2 += '<span class="desconto55">-'+Math.round(produto.desconto)+'% desconto</span> &nbsp;'; *//*
						if(produto.marca.id != 9)
						{
							html2 += '<br><del><span class="delinterior">'+produto.price_before+'</span></del>';
						}						
					}	
				}  */
				
				var dispo_text = '';
				
				if(produto.in_stock)
				{
					if(window.lang == 'es')
					{
						dispo_text = '<span class="interessados33" style=" font-size: 16px; font-weight: bold;"> en stock</span>';
					}
					else
					{
						dispo_text = '<span class="interessados33" style=" font-size: 16px; font-weight: bold;">em stock</span>';
					}
					
				}
				else
				{
					dispo_text = '<span class="interessados33" style=" font-size: 16px;"> </span>';
				}
				
				
											
				html2 += '</div><div class="clear10"></div>';
				
				html2 += '<div class="clear10"></div><div style="    float: right;margin-top: 10px;font-size: 13px;"><a href="#">adicionar ao carrinho</a></div>';
				
				html2 += '<div style="color:#138800 !important; margin-top:10px; font-size: 12px; margin-left:5px">'+dispo_text+'</div>';
				
				html2 += '<div class="clear10"></div><div class="limitedashed"></div> <div class="descricao" style="width: 70%; float:left">';
				
				if (typeof produto['highlights_' +  window.lang] !== 'undefined' && produto['highlights_' +  window.lang].length > 0)
				{
					html2 += '<ul class="listagem">';
					$.each(produto['highlights_' +  window.lang], function(index, value){
						html2 += '<li>'+value+'</li>';
					});
					html2 += '</ul>';
				}
				else
				{
					html2 += cut_intro(produto['intro_' + window.lang]);
				}
				
				html2 += '<div class="clear" style="margin-top:10px"></div></div><div class="marcalista"><img src="https://www.egitana.' + window.lang + '/files/marcas/detalhes/'+produto.marca.image+'" alt="'+produto.marca.name+'" title="'+produto.marca.name+'" style="max-width: 143px;" ></div>';
				
				
				html2 += '</div><div class="imagemlistagem2"><a href="'+produto['url_' + window.lang]+'"><img alt="'+produto['name_' + window.lang]+'" title="'+produto['name_' + window.lang]+'"  style="max-width:100%" src="'+image+'">										</a></div><div style="clear: both;"></div></div>';		

	}
		
	/* ================================ */ 
	position++; });
	
	
	
	html2 += '</div>';
	
	if(html == '')
	{
		html = 'Sem resultados';
		html2 = 'Sem resultados';
	}
	
	if(add_to === true)
	{
		$('.my-product-box').append(html);	
		$('.my-product-box2').append(html2);
	}
	else
	{
		$('.my-product-box').html(html);	
		$('.my-product-box2').html(html2);
	}
	
	
	
	
	var paginate_html = "";
	var paginate_info = '';
	var current_page = data.page + 1;
	
	if(data.nbPages > 1)
	{
		paginate_html += '<ul class="pagination">';
		
		var start = current_page - 2;
		
		if(start<=0)
		{
			start = 1;
		}

		var stop = start + 4;

		if( stop > data.nbPages)
		{
			stop = data.nbPages;
		}
		
		if((stop - start) < 5 &&  data.nbPages > 5)
        {
            start = stop - 4;
        }
		
		if(current_page > 1)
		{
			paginate_html += '<li class="page-item"><a class="page-link" data-page="'+(data.page-1)+'" href="#">< Anterior</a></li>';
		}
		
		for(i = start; i <= stop; i++) {
			
			if(current_page == i)
			{
				paginate_html += '<li class="page-item active"><a class="page-link" data-page="'+(i-1)+'" href="#">'+i+'</a></li>';
			}
			else
			{
				paginate_html += '<li class="page-item"><a class="page-link" data-page="'+(i-1)+'" href="#">'+i+'</a></li>';
			}
		}
		
		if(current_page < data.nbPages)
		{
			paginate_html += '<li class="page-item"><a class="page-link" data-page="'+(data.page+1)+'" href="#">Próxima ></a></li>';
		}
		
		paginate_html += '</ul>';
	}
	
	paginate_info = data.nbHits+' artigos. Página '+current_page+' de '+data.nbPages+'.';
	
	$('.my-products-paginate').html(paginate_html);
	$('.paginate-info').html(paginate_info);
	
	if(current_page < data.nbPages)
	{
		$('.mostrarmais-wrapper').html('<a class="btn page-mostrarmais-link" style="padding: 3px 12px; margin-left: 5px;" data-page="'+(data.page+1)+'" href="#">Mostrar mais</a>');
	}
	else
	{
		$('.mostrarmais-wrapper').html('');
	}
};

$(document).ready(function(){
	
	if($( "#find-content" ).length){
	
	$('.botaovertodas').hide();
	if($('#my-cats-box').height() > 440)
	{
		$('#my-cats-box').height(440);
		$('.botaovertodas').show();
	}
	
	$('.botaovertodas').click(function(e){
		e.preventDefault();
		$('#my-cats-box').height('auto');
		$(this).hide();
	});
	
	
	
	 if($('.filter-form input:checked').length > 0)
	{
		var pageNum = 0;
		var ajax_url =  $('.filter-form').attr('action');
		
		var datas = $('.filter-form').serialize();
		var datasObj = $('.filter-form').serializeArray();
		
		datas += '&filters=' + encodeURIComponent($('.filter-form').attr('data-filters'));
		datas += '&order=' + encodeURIComponent($('#order_select').val());
		
		var datasUrl = $.param(datasObj);
		
		if(datas == '')
		{
			var url = '/filtros=1';
		}
		else
		{
			var url = '/filtros=1&';
		}
		
		datas += '&page='+pageNum;	
		
		var current_path = window.location.pathname;
		var splited_path = current_path.split('/filtros=1');
		
		var replace_url = splited_path[0] + url + datasUrl;
		

		history.replaceState(null, null, replace_url);
		
		
		$.ajax({
            url: ajax_url,			
            type: 'POST',
            data: datas,
            dataType: 'json',
            success: update_my_algolia
        });
	}
	
	$('body').on('change', '.marca_change_select', function(e){
		
		e.preventDefault();
		var marca = $(this).val();
		
		/* update_banners_categorias(marca); */
		
		$('.marca-titulo').remove();
		
		$('.titulo-lista').append('<span class="marca-titulo"> ' + marca + '</span>');
		
		/*$('.filter-form input').prop('checked', false);*/

		$('.check-marcas').each(function(){
			if($(this).attr('value') == marca)
			{
				$(this).prop('checked', true);
			}
			else
			{
				$(this).prop('checked', false);
			}
		});		
		
		
	/*	$('#input_marca').val(marca);*/
		
		var datas = $('.filter-form').serialize();
		var datasObj = $('.filter-form').serializeArray();
		
		datas += '&filters=' + encodeURIComponent($('.filter-form').attr('data-filters'));
		
		var datasUrl = $.param(datasObj);
		
		var ajax_url =  $('.filter-form').attr('action');
		
		if(datas == '')
		{
			var url = '/filtros=1';
		}
		else
		{
			var url = '/filtros=1&';
		}
		
		var current_path = window.location.pathname;
		var splited_path = current_path.split('/filtros=1');
		
		var replace_url = splited_path[0] + url + datasUrl;
		

		history.replaceState(null, null, replace_url);
		
		$.ajax({
            url: ajax_url,			
            type: 'POST',
            data: datas,
            dataType: 'json',
            success: update_my_algolia
        });
		
	});
	
	/* ------------------------- */ 
	
	$('body').on('change', '.hists_perpage_select', function(e){
		
		e.preventDefault();
		var num = $(this).val();
		
		$('#input-histsperpage').val(num);		
	
		
		var datas = $('.filter-form').serialize();
		var datasObj = $('.filter-form').serializeArray();
		
		datas += '&filters=' + encodeURIComponent($('.filter-form').attr('data-filters'));
		
		var datasUrl = $.param(datasObj);
		
		var ajax_url =  $('.filter-form').attr('action');
		
		if(datas == '')
		{
			var url = '/filtros=1';
		}
		else
		{
			var url = '/filtros=1&';
		}
		
		var current_path = window.location.pathname;
		var splited_path = current_path.split('/filtros=1');
		
		var replace_url = splited_path[0] + url + datasUrl;
		

		history.replaceState(null, null, replace_url);
		
		$.ajax({
            url: ajax_url,			
            type: 'POST',
            data: datas,
            dataType: 'json',
            success: update_my_algolia
        });
		
		$.ajax({
            url: '/ajax.php?f=fix_paginate_size',			
            type: 'POST',
            data: {hitsPerPage: num},
            dataType: 'json',
            success: function(){}
        });
		
	});
	
	
	$('body').on('click', '.marca_change', function(e){
		
		e.preventDefault();
		var marca = $(this).attr('data-marca');
		
		update_banners_categorias(marca);
		
		$('.marca-titulo').remove();
		
		$('.titulo-lista').append('<span class="marca-titulo"> ' + marca + '</span>');
		
		$('.filter-form input').prop('checked', false); 
		
		$('.marca_change').removeClass("active");
		$('.marca_change_all').removeClass("active");
		$(this).addClass("active");
		
		
		
		$('#input_marca').val(marca);
		
		var datas = $('#form-filter-by-link').serialize();
		var datasObj = $('#form-filter-by-link').serializeArray();
		
		datas += '&filters=' + encodeURIComponent($('.filter-form').attr('data-filters'));
		
		var datasUrl = $.param(datasObj);
		
		var ajax_url =  $('#form-filter-by-link').attr('action');
		
		if(datas == '')
		{
			var url = '/filtros=1';
		}
		else
		{
			var url = '/filtros=1&';
		}
		
		var current_path = window.location.pathname;
		var splited_path = current_path.split('/filtros=1');
		
		var replace_url = splited_path[0] + url + datasUrl;
		

		history.replaceState(null, null, replace_url);
		
		$.ajax({
            url: ajax_url,			
            type: 'POST',
            data: datas,
            dataType: 'json',
            success: update_my_algolia
        });
		
		$('html, body').animate({
        scrollTop: $("#lista-produtos").offset().top
    }, 1000);
		
	});
	
	$('.change_list_link').click(function(e){
		e.preventDefault();
		
		var elem = this;
		
		$('#list_type_value').val($(elem).attr('data-type'));
		
		$('#change_list_type').submit();
	});
	
	$('body').on('change', '.filter-form select', function(){
		
		
		
		$('.change_order').removeClass("active");
		$('.marca_change').removeClass("active");
		$('.marca_change_all').removeClass("active");
		
		$('.destacados-box').slideUp();
		
		var datas = $(this).parents('form').serialize();
		var datasObj = $(this).parents('form').serializeArray();
		
		datas += '&filters=' + encodeURIComponent($('.filter-form').attr('data-filters'));
		datas += '&order=' + encodeURIComponent($('#order_select').val());
		
		var datasUrl = $.param(datasObj);
		
		var ajax_url =  $(this).parents('form').attr('action');
		
		if(datas == '')
		{
			var url = '/filtros=1';
		}
		else
		{
			var url = '/filtros=1&';
		}
		
		var current_path = window.location.pathname;
		var splited_path = current_path.split('/filtros=1');
		
		var replace_url = splited_path[0] + url + datasUrl;
		

		history.replaceState(null, null, replace_url);
		
		$.ajax({
            url: ajax_url,			
            type: 'POST',
            data: datas,
            dataType: 'json',
            success: update_my_algolia
        });
		
	});
	
	
	$('body').on('change', '.filter-form input', function(){
		
		
		
		/*$('.change_order').removeClass("active");
		$('.marca_change').removeClass("active");
		$('.marca_change_all').removeClass("active"); */ 
		
		$('.destacados-box').slideUp();
		
		var datas = $(this).parents('form').serialize();
		var datasObj = $(this).parents('form').serializeArray();
		
		datas += '&filters=' + encodeURIComponent($('.filter-form').attr('data-filters'));
		datas += '&order=' + encodeURIComponent($('#order_select').val());
		
		var datasUrl = $.param(datasObj);
		
		var ajax_url =  $(this).parents('form').attr('action');
		
		if(datas == '')
		{
			var url = '/filtros=1';
		}
		else 
		{
			var url = '/filtros=1&';
		}
		
		var current_path = window.location.pathname;
		var splited_path = current_path.split('/filtros=1');
		
		var replace_url = splited_path[0] + url + datasUrl;
		

		history.replaceState(null, null, replace_url);
		
		$.ajax({
            url: ajax_url,			
            type: 'POST',
            data: datas,
            dataType: 'json',
            success: update_my_algolia
        });
		
	});
	
	$('body').on('click', '.gotop', function(){
		$("html, body").animate({ scrollTop: 0 });
	});
	
	
	$('body').on('click', '.change_order', function(e){	
		
		e.preventDefault();
		
		var order = $(this).attr('data-value');
		
		$('.filter-form input').prop('checked', false);
		$("input[type=checkbox][value='em stock']").prop("checked",true);
		$("input[type=checkbox][value='en stock']").prop("checked",true);
		
		/*$('.filter-form input').prop('checked', false); */
		
		$('.change_order').removeClass("active");
		$(this).addClass("active");
		
		$('#order_select').val(order);		
		
		var datas = $('.filter-form').serialize();
		var datasObj = $('.filter-form').serializeArray();
		
		datas += '&filters=' + encodeURIComponent($('.filter-form').attr('data-filters'));
		
		
		var datasUrl = $.param(datasObj);
		
		var ajax_url =  $('.filter-form').attr('action');
		
		if(datas == '')
		{
			var url = '/filtros=1';
		}
		else
		{
			var url = '/filtros=1&';
		}
		
		var current_path = window.location.pathname;
		var splited_path = current_path.split('/filtros=1');
		
		var replace_url = splited_path[0] + url + datasUrl;
		

		history.replaceState(null, null, replace_url);
		
		$.ajax({
            url: ajax_url,			
            type: 'POST',
            data: datas,
            dataType: 'json',
            success: update_my_algolia
        });
		
	});
	
	$('body').on('click', '.ajax-paginate .page-link', function(e){
		e.preventDefault();
		
		$('html, body').animate({
        scrollTop: $("#lista_produtos").offset().top
    }, 2000);
		
		var pageNum = $(this).attr('data-page');
		var ajax_url =  $('.filter-form').attr('action');
		
		var datas = $('.filter-form').serialize();
		var datasObj = $('.filter-form').serializeArray();
		
		datas += '&filters=' + encodeURIComponent($('.filter-form').attr('data-filters'));
		datas += '&order=' + encodeURIComponent($('#order_select').val());
		
		var datasUrl = $.param(datasObj);
		
		if(datas == '')
		{
			var url = '/filtros=1';
		}
		else
		{
			var url = '/filtros=1&';
		}
		
		datas += '&page='+pageNum;	
		
		var current_path = window.location.pathname;
		var splited_path = current_path.split('/filtros=1');
		
		var replace_url = splited_path[0] + url + datasUrl + '&page='+pageNum;
		

		history.replaceState(null, null, replace_url);
		
		
		$.ajax({
            url: ajax_url,			
            type: 'POST',
            data: datas,
            dataType: 'json',
            success: update_my_algolia
        });
		
	});
	
	/* mostrar mais ------------------------ */ 
	
	$('body').on('click', '.page-mostrarmais-link', function(e){
		e.preventDefault();
		
		
		
		var pageNum = $(this).attr('data-page');
		var ajax_url =  $('.filter-form').attr('action');
		
		var datas = $('.filter-form').serialize();
		var datasObj = $('.filter-form').serializeArray();
		
		datas += '&filters=' + encodeURIComponent($('.filter-form').attr('data-filters'));
		datas += '&order=' + encodeURIComponent($('#order_select').val());
		
		var datasUrl = $.param(datasObj);
		
		if(datas == '')
		{
			var url = '/filtros=1';
		}
		else
		{
			var url = '/filtros=1&';
		}
		
		datas += '&page='+pageNum;	
		
		var current_path = window.location.pathname;
		var splited_path = current_path.split('/filtros=1');
		
		var replace_url = splited_path[0] + url + datasUrl + '&page='+pageNum;
		

		history.replaceState(null, null, replace_url);
		
		
		$.ajax({
            url: ajax_url,			
            type: 'POST',
            data: datas,
            dataType: 'json',
            success: function(data){
				update_my_algolia(data, true);
			}
        });
		
	});
	
	/* --------------------------------------------------- */
	
	$.ajax({
				url: '/ajax.php?f=find_page',
				dataType: 'text',
				type: 'POST',
				success: function(data){
					
					
					$('#find-content').html(data);
					const searcht = instantsearch({
  appId: 'F7147MCR0G',
  apiKey: '4a27fdd93867e7a4155da8f939c5b750',
  indexName: 'produtos_find',
  searchParameters: {filters: 'estado:1 AND value>0', hitsPerPage: 8},
  urlSync: {
    mapping: {
      q: 'queryt',
	  p: 'page'
  } }
});

searcht.on('render', function(content){
	
	$('#page-title-find').html('Pesquisa por: "' + this.helper.lastResults.query+'"');
	/*$('#page-results-find').html(this.helper.lastResults.nbHits + ' resultados');*/
	var pagina = this.helper.lastResults.page + 1;
	 $('.page-results-find').html(this.helper.lastResults.nbHits + ' resultados. Visualizando a página '+pagina+' de '+this.helper.lastResults.nbPages);
	/* $('.data-produto-name').html('"'+this.helper.lastResults.query+'"'); */
});

var find_cat_timeout = false;

searcht.addWidget(
  instantsearch.widgets.searchBox({
    container: '#q',
    placeholder: window.pesquisar_str,
    autofocus: false,
    poweredBy: false,
	 magnifier: false,
	reset: false,
	wrapInput: false,
	queryHook: function(query, search){
		
		query = query.replace('<', '');
		query = query.replace('</', '');
		query = query.replace('>', '');
		
		console.log('LANG: ' + window.lang); 
		if(query == '')
		{			
			$('#find-content').slideUp();
			/* $('#main-content').show(); */
			$('.for-find').hide();
			
			if ( $( ".sticky_column" ).length ) {
 
				$(document.body).trigger("sticky_kit:recalc");
			 
			}
		}
		else
		{
			$('#find-content').slideDown();
			/*$('#main-content').hide(); */
			$('.for-find').show();
			
			
			searcht.helper.clearRefinements('marca.name');
			searcht.helper.clearRefinements('value');
			search(query);
			
		}
		
		
		
		var page = '/search/' + query;
		
		
		$('.texto_pesquisado').html(query);
		
		if(find_cat_timeout)
		{
			clearTimeout(find_cat_timeout);
		}
		
		 find_cat_timeout = setTimeout(function(){ 
		 
		
			var client = algoliasearch('F7147MCR0G', '4a27fdd93867e7a4155da8f939c5b750');
			var categorias_index = client.initIndex('categorias_more_prods');
			
		    var html_cats = '';
			var html_marcas = '';
			
			categorias_index.search({
									  query: query,
									  filters: 'num_produtos > 0'
			}, (err, { hits } = {}) => {
				
				if(hits.length != 0)
				{
					html_cats = '<div class="container32 fundobranco" style="line-height: 0;"><div class="produtoscima" style="padding-left: 5px;"><ul> ';
					
					for(i = 0; i < hits.length; i++)
					{
						var categoria = hits[i];
						
						if(i < 4)
						{
							var img_link = 'https://template.egitana.' + window.lang + '/no-img/categorias/icon_big/img.png';
							
							if(categoria.image != null && categoria.image != '')
							{
								img_link = 'https://categorias.egitana.' + window.lang + '/icon_big/' + categoria.image;
							}
							
							html_cats += '<li class="listagemcima" style="text-align: left; margin-bottom: 3px; margin-top: 3px; margin-right: 10px; margin-left: 0px;"> <a href="'+categoria['url_' + window.lang]+'" style="color: #685e52;"><h3 class="hlimpo" style="font-size: 14px; color: #685e52;"><img width="49" src="' + img_link + '" alt="" style="vertical-align: middle; display: inline;" > '+categoria._highlightResult['name_' + window.lang].value+'</h3></a></li>';
						}						
					}
					
					html_cats += '</ul> </div><div class="sephorizontal2" style="margin: 0px;"></div></div>';
				}
				
				$('#top-find-cats').html(html_cats);
			});
			
			
			var marcas_index = client.initIndex('marcas');
			
			marcas_index.search(query, (err, { hits } = {}) => {
				
				if(hits.length != 0)
				{
					html_marcas = '<div class="ais-refinement-list--header ais-header">Fabricante</div>';
					
					for(i = 0; i < hits.length; i++)
					{
						var marca = hits[i];
						
						if(i < 8)
						{
							var img_link = 'https://template.egitana.' + window.lang + '/no-img/marcas/listagem/img.png';
							
							if(marca.image != null && marca.image != '')
							{
								img_link = 'https://files.egitana.' + window.lang + '/marcas/detalhes/' + marca.image;
							}
							html_marcas += '<a href="'+marca['url_' + window.lang]+'"><h3 class="hlimpo"><img width="80" src="' + img_link + '" alt="" style="vertical-align: middle; display: inline; margin-bottom: 10px; margin-right: 10px;" /> '+marca.name+'</a><br />';
						}						
					}
					
					html_marcas += '<br />';
				}
				
				$('.top-find-marca').html(html_marcas); 
			});
			
		/* 	$.ajax({
				url: '/ajax.php?f=find_categoria',			
				type: 'POST',
				data: {query: query},
				dataType: 'json', 
				success: function(data){
					var html_cats = '';
					
					if(data.categorias.length != 0)
					{
						
						html_cats = '<div class="container32 fundobranco"><div class="produtoscima"> <div style="padding: 15px"><div class="ais-refinement-list--header ais-header">Categorias</div></div> <ul> ';
						$.each(data.categorias, function(index, categoria){
							html_cats += '<li class="listagemcima" style="text-align: left;"><a href="'+categoria.link+'"><div class="caixacategorias-find" style="text-align: center"><img src="'+categoria.img+'" alt="'+categoria.name+'"><div style="padding-top: 5px; font-size: 15px; min-height: 50px;"><h3 class="hlimpo">'+categoria.name+'</h3></div></div></a></li>';
							
						});
						
						html_cats += '</ul> </div><div class="sephorizontal2" style="margin: 0px;"></div></div>';
						
						
					}
					
					$('#top-find-cats').html(html_cats);
				}
			}); */
			
			/* $.ajax({
				url: '/ajax.php?f=find_marca',			
				type: 'POST',
				data: {query: query},
				dataType: 'json',
				success: function(data){
					
					var html_marcas = '';
					
					if(data.marcas.length != 0)
					{
						html_marcas = '<div class="ais-refinement-list--header ais-header">Fabricante</div>';
						
						$.each(data.marcas, function(index, marca){
							html_marcas += '<a href="'+marca.link+'">'+marca.name+'</a><br />';
						});
						
						html_marcas += '<br />';
						
					}
					
					
					
					$('.top-find-marca').html(html_marcas);
				}
			}); */
			
		}, 200); 
		
		return true;
	}
  })
);

/*
searcht.addWidget(
  instantsearch.widgets.sortBySelector({
    container: '#sort-by-containert',
    indices: [
      {name: 'produtos_find', label: 'Relevância'},
      {name: 'produtos_preco_asc', label: 'Preço menor'},
      {name: 'produtos_preco_desc', label: 'Preço maior'}
    ]
  })
); */

var text_ver_mais_produtos = 'Ver mais produtos';
var text_disponibilidade = 'Disponibilidade';
var text_fabricante = 'Fabricante';
var text_categorias = 'Categorias';

if(window.lang == 'es')
{
	text_ver_mais_produtos = 'Ver más productos';
	text_disponibilidade = 'Disponibilidad';
	text_fabricante = 'Fabricante';
	text_categorias = 'Categorias';
}

searcht.addWidget(
    instantsearch.widgets.hits({
      container: '#hitst',
	  	  
	  showMoreLabel: text_ver_mais_produtos,
	  templates: {
        empty: 'No results',
		allItems: function(items){ 
		
		var html = '<div class="row">';
		
		var count_prods = 0;
		
		$.each(items.hits, function(index, produto){		
		
	if(!produto.image)
	{
		var image = 'https://template.egitana.' + window.lang + '/no-img/produtos/listagem/img.png';
	}
	else
	{
		var image = 'https://detalhes.egitana.' + window.lang + '/'+produto.image
	}
	
	html += '<a href="'+produto['url_' + window.lang]+'?pes=1"><div class="col-sm-3 caixaprodutopesquisa" style="min-height: 210px;";><div class="paddinginterior"> <img src="'+image+'" alt="'+produto['name_' + window.lang]+'" style="max-width: 270px; width: 100%" title="'+produto['name_' + window.lang]+'"><div class="nomeprodutocaixa"><h3 class="hlimpo">'+produto._highlightResult['name_' + window.lang].value+'</h3></div> <div class="preco3"><span >'+produto['price_' + window.lang]+produto['sob_consulta_' + window.lang]+'</span></div>';
	
	if(produto.price_before !== '' && produto['sob_consulta_' + window.lang] === '')
	{
		/*if(Math.round(produto.desconto) >= 5)  
		{
			html += '<div class="precoantigo2">';
			if(produto.marca.id != 9)
			{
			html += '<span class="riscado">'+produto.price_before+'</span>';	
			}
			
			html += '<br><div class="desconto">'+Math.round(produto.desconto)+'%</div>';
			html += '</div>';
		} */
	}
	
	/*html += '<div class="clear3"></div>';*/
	if(produto.stock > 0)
	{
		if(window.lang == 'es')
		{
			html += '<span class="entrega" style="margin-left: 20px; line-height: 48px;"><i class="fa fa-check-square-o" aria-hidden="true"></i> En stock &nbsp;</span>';
		}
		else
		{
			html += '<span class="entrega" style="margin-left: 20px; line-height: 48px;"><i class="fa fa-check-square-o" aria-hidden="true"></i> Em stock &nbsp;</span>';
		}
		
	} 
	
	/*html += '<span class="entrega">'+produto['dispo_' + window.lang]+'</span>';
		html += '';*/
	
	

	html += '</div></div></a>';
	
	count_prods++;
	
	if(count_prods == 4){  
	   html += '</div><div class="sephorizontal2" style="margin-top: 5px; margin-bottom: 5px;"></div><div class="row">';
	}
	
		
	 });
	 
	 html += '</div>';
		
		return html;  }     
      }
    })
  );
  
 searcht.addWidget(
  instantsearch.widgets.pagination({
    container: '#pagination-containert',
	maxPages: 5,
	showFirstLast: false,
	cssClasses: {
		root: 'pagination',
		item: 'page-item',
		link: 'page-link',
		active: 'active',		
	}
  })
); 

  
/* ------------------ */



searcht.addWidget(
  instantsearch.widgets.refinementList({
    container: '#brandst',
    attributeName: 'marca.name',
    operator: 'or',
    limit: 4,
	sortBy: ['count:desc'],
	showMore: {
		templates: {
			active: '<a href="#" class="ais-show-more">'+text_ver_menos+'</a>',
			inactive: '<a href="#" class="ais-show-more">'+text_ver_mais+'</a>'
		}
	},	
    templates: {
      header: text_fabricante
    }
  })
);

searcht.addWidget(
  instantsearch.widgets.refinementList({
    container: '#dispot',
    attributeName: 'dispo_' + window.lang,
    operator: 'or',
    limit: 4,
	sortBy: ['count:desc'],
	showMore: {
		templates: {
			active: '<a href="#" class="ais-show-more">'+text_ver_menos+'</a>',
			inactive: '<a href="#" class="ais-show-more">'+text_ver_mais+'</a>'
		}
	},	
    templates: {
      header: text_disponibilidade
    }
  })
);

searcht.addWidget(
  instantsearch.widgets.refinementList({
    container: '#categoriast',
    attributeName: 'categorias.name_' + window.lang, 
    operator: 'or',
    limit: 4,
	sortBy: ['count:desc'],
	showMore: {
		templates: {
			active: '<a href="#" class="ais-show-more">'+text_ver_menos+'</a>',
			inactive: '<a href="#" class="ais-show-more">'+text_ver_mais+'</a>'
		}
	},
    templates: {
      header: text_categorias
    }
  })
);


/*
searcht.addWidget(
  instantsearch.widgets.refinementList({
    container: '#pricet',
    attributeName: 'filtro_preco', 
	operator: 'or',
	sortBy: ['name:asc'],
    templates: {
      header: 'Preço'
    },    
  })
);
*/
searcht.addWidget(
  instantsearch.widgets.clearAll({
    container: '#clear-allt',
	clearsQuery: true,
	
    templates: {
      link: 'Limpar todos'
    },
    autoHideContainer: false
  })
);


 

searcht.start();

$('.ais-search-box--input').keyup(function(e){
    if(e.keyCode == 13)
    {
        var keywords = $(this).val();
		if(keywords != '')
		{
			var replaced = keywords.split(' ').join('+');
			if(window.lang == 'es')
			{
				window.location="https://www.egitana." + window.lang + "/es/find/search="+replaced;
			}
			else
			{
				window.location="https://www.egitana." + window.lang + "/find/search="+replaced;
			}			
		}
    }
});


$('.close-find').click(
	function(){
		
		 $('.ais-clear-all--link').trigger('click');
		 $('.ais-clear-all--link').trigger('mousedown');
		 $('.ais-clear-all--link').trigger('mouseup');
		 $('#clear-allt').trigger('click');
		  $('#clear-allt').trigger('mousedown');
		   $('#clear-allt').trigger('mouseup');
		$('#find-content').slideUp();
	}
	);

				}
			});	  
  
	
	} });


if($("#valid_visita").length != 0) {
	
	var id_produto = $("#valid_visita").attr('data-id');
	var valid_visita_timeout = setTimeout(function(){
		
		$.ajax({
            url: '/ajax.php?f=valid_visit',			
            type: 'POST',
            data: {id_produto: id_produto},
            dataType: 'text',
            success: function(data){
				console.log(data);
			}
			
        });
}, 5000);
}
	

var get_vars = getUrlVars();

if(get_vars['queryt'] != undefined)
{
	if(get_vars['queryt'] != '')
	{
		$('#find-content').slideDown();
		/* $('#main-content').hide(); */
	}
} 

function getUrlVars() {
var vars = {};
var aux = window.location.href.split('?');

if(typeof aux[1] !== 'undefined')
{
	var str_parts = aux[1].split('&');
	
	$.each(str_parts, function(index, part){
		var separate = part.split('=');
		if(typeof separate[1] !== 'undefined')
		{
			vars[separate[0]] = separate[1];
		}
	});
}

console.log(vars);
return vars;
}