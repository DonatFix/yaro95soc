if ( $( "#find-content" ).length ) {
	
var close_menu_timeout = false;
var categorias = {};  
var client = algoliasearch("F7147MCR0G", "4a27fdd93867e7a4155da8f939c5b750");
var index_categorias = client.initIndex('categorias');

// only query string
index_categorias.search({ query: '' }, function searchDone(err, content) {
  if (err) {
    console.error(err);
    return;
  }
  
  $('.menu-hidden').hide();

  
  $.each(content.hits, function(index, categoria){
	  if(categoria.show)
	  {
		  if(categoria.pai == '')
		  {
			  categoria.pai = '0';
		  }
		  
		  if(categorias[categoria.pai] != undefined)
		  {
			  categorias[categoria.pai].push(categoria);
		  }
		  else
		  {
			  categorias[categoria.pai] = [];
			  categorias[categoria.pai].push(categoria);
		  }
	  }
  });
  
  /*
  $.each(categorias, function(id_pai, cats){
	  if(id_pai != 0)
	  {
		categorias[id_pai].sort(function(a,b) {return (a.name > b.name) ? 1 : ((b.name > a.name) ? -1 : 0);}); 
	  }
  })
  */
  egitana_cats_home(categorias);
  egitana_nav_start(categorias);
  egitana_menu_footer(categorias);
  
}); 

function egitana_menu_footer(categorias)
{
	var html = '';
	
	$.each(categorias[0], function(key, cat){		
		
			html += '<li><a href="'+cat.url+'" >'+cat.name+'</a></li>';		
		
	});
	
	$('.categorias_footer').html(html);
}

function egitana_cats_home(categorias)
{
	var html = '<div class="row">';
	var count_cats = 1;
	$.each(categorias[0], function(key, cat){		
		html += '<div class="categoriasrelacionadas"><a href="'+cat.url+'"><img src="https://www.egitana.pt/files/categorias/icon_big/'+cat.image+'" alt="'+cat.name+'" title="'+cat.name+'"><span><h3 class="hlimpo" style="min-width: 145px;">'+cat.name+'</h3></span><div class="appear2">&gt; ver produtos</div></a></div>';
		
		if(!(count_cats%4))
		{
			html += '</div><div class="row">';
		}
		
		count_cats++;
	});
	
	html += '</div>'
	
	$('.categorias_home').html(html);
}


function egitana_nav_start(categorias)
{
	var html = '';
	
	$.each(categorias[0], function(key, cat){
		
		if(categorias[cat.id] != undefined)
		{
			if(cat.image_small != '')
			{
				html += '<li><a href="'+cat.url+'" data-id="'+cat.id+'" class="open-sub"><img src="https://www.egitana.pt/files/categorias/icon_small/'+cat.image_small+'" alt="'+cat.name+'"/> '+cat.name+'</a></li>';
			}
			else
			{
				html += '<li><a href="'+cat.url+'" data-id="'+cat.id+'" class="open-sub"><img src="https://www.egitana.pt/templates/egitana/no-img/categorias/icon_big/img.png" alt="'+cat.name+'"/> '+cat.name+'</a></li>';				
			}
			
		}
		else
		{
			if(cat.image_small != '')
			{
				html += '<li><a href="'+cat.url+'" ><img src="https://www.egitana.pt/files/categorias/icon_small/'+cat.image_small+'" alt="'+cat.name+'"/> '+cat.name+'</a></li>';
			}
			else
			{
				html += '<li><a href="'+cat.url+'" ><img src="https://www.egitana.pt/templates/egitana/no-img/categorias/icon_big/img.png" alt="'+cat.name+'"/> '+cat.name+'</a></li>';						
			}			
		}
		
	});
	
	$('.egitana_nav').find('.menu-first').html(html);
}

$('body').on('mouseenter', '.egitana_nav li a', function(e){
	
	$('.egitana_nav li:first').removeClass('activesoft');
	
	if(close_menu_timeout !== false)
	{
		clearTimeout(close_menu_timeout);
	}
	e.preventDefault();
	var elem = this;
	var pai = $(elem).attr('data-id');
	var html = '';
	
	if($(elem).hasClass('open-sub'))
	{
	
	
	
	/*if($(elem).parent('li').hasClass('menuactivo'))
	{
		window.location=$(elem).attr('href');
	}*/
	
	if($("#dimmer").length == 0){
		$('body').append('<div id="dimmer" style="display: block;"></div>');
		lock_scroll();
	}
	
	
	/*$(elem).parents('ul').find('li').removeClass('menuactivo');
	$(elem).parent('li').addClass('menuactivo');*/
	$(elem).parents('.egitana_nav_col').nextAll('.egitana_nav_col').remove();
	
	$.each(categorias[pai], function(key, cat){
		
	if(categorias[cat.id] != undefined)
	{
		html += '<li class="has-sub2"><a href="'+cat.url+'" data-id="'+cat.id+'" class="open-sub">';
		if(cat.destaque){
			html += '<b>';
		}
		html += cat.name;
		if(cat.destaque){
			html += '</b>';
		}
		html += '</a></li>';
	}
	else
	{
		html += '<li><a href="'+cat.url+'" onclick="ga(\'send\', \'event\', \'Menu\', \''+cat.name+'\', \''+cat.url+'\');" >';
		
		if(cat.destaque){
			html += '<b>';
		}
		
		html += cat.name;
		
		if(cat.destaque){
			html += '</b>';
		}
		
		html += '</a></li>';
	}		
	});
	
	if($(elem).parents('.egitana_nav_col').hasClass('grey'))
	{
		var html_sub = '<div class="egitana_nav_sub egitana_nav_col"><ul>'+html+'</ul></div>'; 
		
	}
	else
	{
		var html_sub = '<div class="egitana_nav_sub egitana_nav_col grey"><ul>'+html+'</ul></div>'; 
	}
	
	$('.egitana_nav').append(html_sub);
	
	}
	else
	{		
		$(elem).parents('.egitana_nav_col').nextAll('.egitana_nav_col').remove();
	}
	
});



$('body').on('mouseenter', '#dimmer', function(){
	
	var elem = this; 
	
	close_menu_timeout = setTimeout(function(){ $('.menuactivo').removeClass('menuactivo');
	$('.egitana_nav_sub').remove();
	$(elem).remove();
	unlock_scroll();
	$('.menu-hidden').hide(); }, 400);
	
});


$('.egitana_nav_open').mouseenter(function(e){
	e.preventDefault();	
	
	if($("#dimmer").length == 0){
		$('.menu-hidden').slideDown();
		$('body').append('<div id="dimmer" style="display: block;"></div>');
		lock_scroll();
		$('.egitana_nav li:first a').trigger('mouseenter');
		$('.egitana_nav li:first').addClass('activesoft');
	} else {
	/*	$('.menuactivo').removeClass('menuactivo');
		$('.egitana_nav_sub').remove();
		$("#dimmer").remove();
		$('.menu-hidden').hide();
		unlock_scroll();*/
	}
});

}

function lock_scroll()
{
	$('html').on('scroll mousewheel touchmove', function(e) {
		  e.preventDefault();
		  e.stopPropagation();
		  return false;
	});	
}

function unlock_scroll()
{
	$('html').unbind('scroll mousewheel touchmove');
}